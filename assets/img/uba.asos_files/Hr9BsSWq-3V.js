__d("PolarisBaseGraphQLEventHandler",[],function(e,t,n,i,r,s){"use strict";var o="1/graphqlsubscriptions/",a=Object.freeze({PRESENCE:"Presence",BD_CHALLENGE:"BdChallenge",WAVE:"Wave",PINNED_QUESTION:"PinnedQuestion",QUESTION_STATUS:"QuestionStatus",NONE:""});e=function(){function e(){}var t=e.prototype;return t.processEventMessage=function(){},t.getSubTopic=function(){return null},t.getGraphQLSubsciptionPrefix=function(){return o},t.getType=function(){return a.NONE},e}(),s.GRAPH_QL_EVENT_TYPES=a,s.BaseGraphQLEventHandler=e},66),__d("PolarisBdChallengeGraphQLEventHandler",["JSResourceForInteraction","PolarisBaseGraphQLEventHandler","PolarisDirectLogger","uuid","xigRequireInterop"],function(e,t,n,i,r,s,o){"use strict";var a="17935802131473058";e=function(e){function t(t){var r;return(r=e.call(this)||this).$BdChallengeGraphQLEventHandler1=new(i("PolarisDirectLogger").DirectLogger)("BDChallengeGraphQLEventHandler",t),r.$BdChallengeGraphQLEventHandler1.debugTrace("bd_challenge_gql_handler_init"),r.$BdChallengeGraphQLEventHandler2=r.getGraphQLSubsciptionPrefix()+a+"/"+JSON.stringify({input_data:{client_subscription_id:n("uuid")()}}),r}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.processEventMessage=function(e){var t=e.bd_challenge_event;null!=t?n("JSResourceForInteraction")("PolarisBDClientSignalCollectionTrigger").__setRef("PolarisBdChallengeGraphQLEventHandler").load().then(function(e){return n("xigRequireInterop")(e)}).then(function(e){(e=e.BDClientSignalCollectionTrigger).handleBdChallenge(t)}):this.$BdChallengeGraphQLEventHandler1.debugTrace("parsed_message_bad_data")},r.getSubTopic=function(){return this.$BdChallengeGraphQLEventHandler2},r.getType=function(){return i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.BD_CHALLENGE},t}(i("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler),o.BdChallengeGraphQLEventHandler=e},98),__d("PolarisDirectBaseSubscription",[],function(e,t,n,i,r,s){"use strict";e=function(){function e(e,t,n,i){var r=this;this.$5=function(e){r.$4.debugTrace("message_received");var t=r.parsePayload(e);if(null!=t)if(0!==e.length){"\0"===e[e.length-1]?(t=e.substring(0,e.length-1),r.$4.debugTrace("trimmed_null_char")):t=e;var n={};try{n=JSON.parse(t)}catch(n){return"string"==typeof n.message&&n.message.includes("Unexpected token")&&(n.jsonFirstChars="string"==typeof t?t.substr(0,3):null),void r.$4.logError("Cannot parse message "+e,n)}r.processMessage(n)}else r.$4.logError("empty_message")},this.$1=e,this.$2=t,this.$3=n,this.$4=i,this.$4.debugTrace("ctor")}var t=e.prototype;return t.parsePayload=function(e){return e},t.processMessage=function(){},t.$6=function(e){var t;return JSON.stringify(((t={})[e]=this.getSubTopics(),t))},t.subscribe=function(){this.getSubTopics().length<1?this.$4.debugTrace("no_subtopics_to_subscribe"):(this.$4.debugTrace("subscribe_start"),this.unsubscribe(),this.$3.subscribe(this.$1,this.$5),this.$3.publish(this.$1,this.$6("sub")),this.$4.debugTrace("subscribe_end"))},t.unsubscribe=function(){this.getSubTopics().length<1?this.$4.debugTrace("no_subtopics_to_unsubscribe"):(this.$4.debugTrace("unsubscribe_start"),this.$3.publish(this.$1,this.$6("unsub")),this.$3.unsubscribe(this.$1),this.$4.debugTrace("unsubscribe_end"))},t.updateSubTopics=function(e){this.$2=e},t.getSubTopics=function(){return this.$2},e}(),s.DirectBaseSubscription=e},66),__d("PolarisPinnedQuestionGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","uuid"],function(e,t,n,i,r,s,o){"use strict";var a="PINNED_QUESTION",c="18005526940184517";e=function(e){function t(t,i){var r;return(r=e.call(this)||this).$PinnedQuestionGraphQLEventHandler1=t,r.$PinnedQuestionGraphQLEventHandler2=r.getGraphQLSubsciptionPrefix()+c+"/"+JSON.stringify({input_data:{client_subscription_id:n("uuid")(),broadcast_id:String(i.id)}}),r}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.processEventMessage=function(e){null!=(e=e.live_active_question_event)&&(e={question:e,type:a},this.$PinnedQuestionGraphQLEventHandler1.eventHandler(e))},r.getSubTopic=function(){return this.$PinnedQuestionGraphQLEventHandler2},r.getType=function(){return i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION},t}(i("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler),o.PinnedQuestionGraphQLEventHandler=e},98),__d("PolarisPresenceGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","PolarisDirectLogger","uuid"],function(e,t,n,i,r,s,o){"use strict";var a="17846944882223835";e=function(e){function t(t,r){var s;return(s=e.call(this)||this).$PresenceGraphQLEventHandler2=new(i("PolarisDirectLogger").DirectLogger)("PresenceGraphQLEventHandler",r),s.$PresenceGraphQLEventHandler1=t,s.$PresenceGraphQLEventHandler2.debugTrace("presence_gql_handler_init"),s.$PresenceGraphQLEventHandler3=s.getGraphQLSubsciptionPrefix()+a+"/"+JSON.stringify({input_data:{client_subscription_id:n("uuid")()}}),s}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.processEventMessage=function(e){null!=(e=e.presence_event)?this.$PresenceGraphQLEventHandler1.onPresenceUpdated(e):this.$PresenceGraphQLEventHandler2.debugTrace("parsed_message_bad_data")},r.getSubTopic=function(){return this.$PresenceGraphQLEventHandler3},r.getType=function(){return i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE},t}(i("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler),o.PresenceGraphQLEventHandler=e},98),__d("PolarisQuestionStatusGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","uuid"],function(e,t,n,i,r,s,o){"use strict";var a="QUESTION_STATUS",c="18027779584026952";e=function(e){function t(t,i){var r;return(r=e.call(this)||this).$QuestionStatusGraphQLEventHandler1=t,r.$QuestionStatusGraphQLEventHandler2=r.getGraphQLSubsciptionPrefix()+c+"/"+JSON.stringify({input_data:{client_subscription_id:n("uuid")(),broadcast_id:String(i.id)}}),r}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.processEventMessage=function(e){null!=(e=e.live_question_submission_status_event)&&(e={status:e,type:a},this.$QuestionStatusGraphQLEventHandler1.eventHandler(e))},r.getSubTopic=function(){return this.$QuestionStatusGraphQLEventHandler2},r.getType=function(){return i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS},t}(i("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler),o.QuestionStatusGraphQLEventHandler=e},98),__d("PolarisWaveGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","PolarisConfig","uuid"],function(e,t,n,i,r,s,o){"use strict";var a="LIVE_WAVE",c="17882305414154951";e=function(e){function t(t,r){var s;return(s=e.call(this)||this).$WaveGraphQLEventHandler1=t,s.$WaveGraphQLEventHandler2=s.getGraphQLSubsciptionPrefix()+c+"/"+JSON.stringify({input_data:{client_subscription_id:n("uuid")(),receiver_id:i("PolarisConfig").getViewerId(),broadcast_id:String(r.id)},publish_data:{broadcast_id:String(r.id),receiver_id:i("PolarisConfig").getViewerId(),waver_id:String(r.broadcast_owner)}}),s}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.processEventMessage=function(e){null!=(e=e.live_video_wave_event)&&(e={type:a,wave:e},this.$WaveGraphQLEventHandler1.eventHandler(e))},r.getSubTopic=function(){return this.$WaveGraphQLEventHandler2},r.getType=function(){return i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE},t}(i("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler),o.WaveGraphQLEventHandler=e},98),__d("PolarisDirectGraphQLSubscription",["PolarisBaseGraphQLEventHandler","PolarisBdChallengeGraphQLEventHandler","PolarisDirectBaseSubscription","PolarisDirectLogger","PolarisPinnedQuestionGraphQLEventHandler","PolarisPresenceGraphQLEventHandler","PolarisQuestionStatusGraphQLEventHandler","PolarisWaveGraphQLEventHandler"],function(e,t,n,i,r,s,o){"use strict";var a="/ig_realtime_sub";e=function(e){function t(t,n,r){return r=new(i("PolarisDirectLogger").DirectLogger)("DirectGraphQLSubscription",r),(n=e.call(this,a,[],n,r)||this).$DirectGraphQLSubscription2=r,n.$DirectGraphQLSubscription1=t,n.$DirectGraphQLSubscription3=new Map,n.$DirectGraphQLSubscription4(),n.getSubTopics(),n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.$DirectGraphQLSubscription4=function(){for(var e=Object.keys(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES),t=0;t<e.length;t++){var n=e[t];i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[n]!==i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE&&i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[n]!==i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE&&i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[n]!==i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION&&!this.$DirectGraphQLSubscription5(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[n])&&this.$DirectGraphQLSubscription2.debugTrace("invalid_handler_type")}},n.getSubTopics=function(){var e=[],t=this.$DirectGraphQLSubscription3,n=Array.isArray(t),i=0;for(t=n?t:t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}(r=r)[0],null!=(r=(r=r[1]).getSubTopic())&&""!==r&&e.push(r)}return this.updateSubTopics(e),e},n.processMessage=function(t){var n=this.$DirectGraphQLSubscription3,i=Array.isArray(n),r=0;for(n=i?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(i){if(r>=n.length)break;s=n[r++]}else{if((r=n.next()).done)break;s=r.value}(s=s)[0],(s=s[1]).processEventMessage(t)}e.prototype.processMessage.call(this,t)},n.enableOrDisableEventHandlerByType=function(e,t){return t?this.$DirectGraphQLSubscription5(e)||this.$DirectGraphQLSubscription2.debugTrace("invalid_handler_type"):this.$DirectGraphQLSubscription3["delete"](e),this},n.$DirectGraphQLSubscription5=function(e){this.$DirectGraphQLSubscription3||(this.$DirectGraphQLSubscription3=new Map);var t=this.$DirectGraphQLSubscription6(e);return null!=t&&(this.$DirectGraphQLSubscription3.set(e,t),!0)},n.$DirectGraphQLSubscription6=function(e){switch(e){case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE:return new(i("PolarisPresenceGraphQLEventHandler").PresenceGraphQLEventHandler)(this.$DirectGraphQLSubscription1,this.$DirectGraphQLSubscription2.getDebugId());case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.BD_CHALLENGE:return new(i("PolarisBdChallengeGraphQLEventHandler").BdChallengeGraphQLEventHandler)(this.$DirectGraphQLSubscription2.getDebugId());default:return null}},n.enableLiveEventHandler=function(e,t,n){switch(n){case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription3.set(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE,new(i("PolarisWaveGraphQLEventHandler").WaveGraphQLEventHandler)(t,e)),this;case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription3.set(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION,new(i("PolarisPinnedQuestionGraphQLEventHandler").PinnedQuestionGraphQLEventHandler)(t,e)),this;case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription3.set(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS,new(i("PolarisQuestionStatusGraphQLEventHandler").QuestionStatusGraphQLEventHandler)(t,e)),this;default:return this}},n.disableLiveEventHandler=function(e){switch(e){case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription3["delete"](i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE),this;case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription3["delete"](i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION),this;case i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription3["delete"](i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS),this;default:return this}},n.unsubscribeGraphQL=function(){this.unsubscribe(),this.enableOrDisableEventHandlerByType(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE,!1),this.enableOrDisableEventHandlerByType(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE,!1)},t}(i("PolarisDirectBaseSubscription").DirectBaseSubscription),o.DirectGraphQLSubscription=e},98),__d("PolarisDirectIrisSubscription",["PolarisDirectLogger","isObject","polarisUnexpected"],function(e,t,n,i,r,s,o){"use strict";var a=1,c=2,u=1e3,l=64e3;e=function(){function e(e,t,r,s){var o=this;this.$7=function(){o.$6.logDirectClientEvent("ig_direct_iris_subscription",i("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers["extends"]({},o.$2,{action:"attempt",attempt_reason:"mqtt-connected"})),o.$1.onIrisConnectivityChanged("Subscribing");var e=JSON.stringify(o.$2);o.$3.publish("/ig_sub_iris",e)["catch"](function(e){o.$6.logDirectClientEvent("ig_direct_iris_subscription",i("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers["extends"]({},o.$2,{action:"error",error:JSON.stringify(e)})),o.$1.onIrisConnectivityChanged("Unsubscribed")})},this.$8=function(e){var t;if("string"==typeof e||e instanceof String)try{t=JSON.parse(e)}catch(e){var r="Could not parse sub iris response $(response)";o.$6.logError(r,e),n("polarisUnexpected")(r),t=e}else n("isObject")(e)?t=e:(n("polarisUnexpected")("Unknown sub iris response $(response)"),t={succeeded:!1});!0===t.succeeded?(o.$6.logDirectClientEvent("ig_direct_iris_subscription",i("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers["extends"]({},o.$2,{action:"success"})),o.$1.onIrisConnectivityChanged("Subscribed",o.$2.subscription_type)):(o.$6.logDirectClientEvent("ig_direct_iris_subscription",i("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers["extends"]({},o.$2,t,{action:"error"})),o.$1.onIrisConnectivityChanged("Unsubscribed"),t.error_type===a?o.$1.onResnapshotRequested(o.$2):t.error_type===c&&(r=o.$4+Math.floor(1e3*Math.random()),window.setTimeout(o.$7,r),o.$4=Math.min(2*o.$4,l)))},this.$6=new(i("PolarisDirectLogger").DirectLogger)("DirectIrisSubscription",s),this.$6.debugTrace("ctor",t),this.$1=e,this.$2=t,this.$3=r,this.$4=u}var t=e.prototype;return t.subscribe=function(){this.$6.debugTrace("subscribe_start"),this.unsubscribe(),this.$3.subscribe("/ig_sub_iris_response",this.$8),this.$7(),this.$6.debugTrace("subscribe_end")},t.unsubscribe=function(){this.$6.debugTrace("unsubscribe_start"),this.$5&&(window.clearTimeout(this.$5),this.$5=null),this.$3.unsubscribe("/ig_sub_iris_response"),this.$1.onIrisConnectivityChanged("Unsubscribed"),this.$6.debugTrace("unsubscribe_end")},e}(),o.DirectIrisSubscription=e},98),__d("PolarisDirectSkywalkerSubscription",["PolarisConfig","PolarisDirectBaseSubscription","PolarisDirectLogger","nullthrows"],function(e,t,n,i,r,s,o){"use strict";var a="/pubsub";e=function(e){function t(t,r,s){return s=new(i("PolarisDirectLogger").DirectLogger)("DirectSkywalkerSubscription",s),(r=e.call(this,a,["ig/u/v1/"+n("nullthrows")(i("PolarisConfig").getViewerId())],r,s)||this).$DirectSkywalkerSubscription2=s,r.$DirectSkywalkerSubscription1=t,r}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.parsePayload=function(t){return-1===t.indexOf("/activity_indicator_id/")?(this.$DirectSkywalkerSubscription2.debugTrace("not_activity_indicator_message"),null):e.prototype.parsePayload.call(this,t)},r.processMessage=function(t){var n=t.data;if("patch"===(i=t.event))if(Array.isArray(n)){var i=n,r=0;for(i=(n=Array.isArray(i))?i:i["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(n){if(r>=i.length)break;s=i[r++]}else{if((r=i.next()).done)break;s=r.value}s=s,this.$DirectSkywalkerSubscription1.handleDelta(s,"")}e.prototype.processMessage.call(this,t)}else this.$DirectSkywalkerSubscription2.debugTrace("parsed_message_bad_data",typeof n);else this.$DirectSkywalkerSubscription2.debugTrace("skipped_message",{event:i})},t}(i("PolarisDirectBaseSubscription").DirectBaseSubscription),o.DirectSkywalkerSubscription=e},98),__d("PolarisLiveDeltaHandler",[],function(e,t,n,i,r,s){"use strict";e=function(e){this.eventHandler=e},s["default"]=e},66),__d("PolarisChannelClientID",["uuid"],function(e,t,n,i,r,s,o){"use strict";var a=n("uuid")();t={getID:function(){return a}},o["default"]=t},98),__d("PolarisMqttEnv",[],function(e,t,n,i,r){"use strict";e=Object.freeze({mqtt_ep_with_sid:0,mqtt_waterfall_log_client_sampling:1,messenger_uses_mqtt_rollout:2,mqtt_ws_polling_enabled:3,mqtt_ws_forced_polling_only:4,mqtt_send_unload_event:6,mqtt_ws_reconnect_reset:7,mqtt_lp_use_fetch:9,mqtt_fast_lp:11}),t=function(){function e(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=null,this.$9=null,this.$10=null,this.$11=null}var t=e.prototype;return t.random=function(){return null!=this.$1?this.$1():Math.random()},t.isUserLoggedInNow=function(){return null==this.$2||this.$2()},t.clearTimeout=function(e){null==this.$3?window.clearTimeout(e):this.$3(e)},t.setTimeout=function(){for(var e=arguments.length,t=new Array(e>2?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return null!=this.$4?this.$4.apply(null,arguments):window.setTimeout.apply(null,arguments)},t.getLoggerInstance=function(){return null!=this.$5?this.$5():s.getInstance()},t.genGk=function(e){return null!=this.$6&&this.$6(e)},t.createSocket=function(e,t){return null!=this.$7?this.$7(e,t):new WebSocket(e)},t.scheduleCallback=function(e){return null!=this.$8?this.$8(e):e()},t.scheduleLoggingCallback=function(e){return null!=this.$9?this.$9(e):e()},t.configRead=function(e,t){return null!=this.$10?this.$10(e,t):t},t.configWrite=function(e,t){null!=this.$11&&this.$11(e,t)},t.initialize=function(e,t,n,i,r,s,o,a,c,u,l){this.$1=e,this.$2=t,this.$3=n,this.$4=i,this.$5=r,this.$6=s,this.$7=o,this.$8=a,this.$9=c,this.$10=u,this.$11=l},e}();var s=function(){function e(){}e.getInstance=function(){return new e};var t=e.prototype;return t.setAppId=function(){},t.eventLogConnect=function(e){e.attemptNumber,e.connectionStatus,e.duration,e.errorCode,e.errorMessage,e.failTotal,e.hostname,e.publishes,e.sessionID,e.subscribedTopics,e.successTotal},t.eventLogPull=function(e){e.duration,e.errorMessage,e.hostname,e.pullEventName,e.sessionID,e.status},t.eventLogDisconnect=function(e){e.duration,e.errorCode,e.errorMessage,e.sessionID},t.eventLogPublish=function(e){e.connectionStatus,e.publishStatus,e.sessionID,e.topic},t.eventLogMiscellaneousError=function(e){e.errorMessage},t.logError=function(){},t.logErrorWarn=function(){},t.logWarn=function(){},t.debugTrace=function(){},t.bumpCounter=function(){},e}();r.exports={Env:new t,MqttGkNames:e}},null),__d("PolarisIrisSubscribeChecker",["PolarisMqttEnv"],function(e,t,n,i,r){"use strict";var s=t("PolarisMqttEnv").Env,o=t("PolarisMqttEnv").MqttGkNames;e=function(){function e(e){this.$1=s.getLoggerInstance(),this.$2=null,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=!0,this.$7=0,this.$8=e,"undefined"!=typeof window&&("m.facebook.com"===(e=window.location.hostname)||"mobile.facebook.com"===e||"mtouch.facebook.com"===e)&&(this.$6=!1),s.genGk(o.messenger_uses_mqtt_rollout)||(this.$6=!1)}var t=e.prototype;return t.start=function(){this.$6=!0},t.stop=function(){this.$6=!1,this.$9()},t.onConnectAttempt=function(){},t.onConnectFailure=function(){this.$9()},t.onConnected=function(){var e=this;this.$7++,this.$9(),this.$3=!1,this.$4=!1,this.$5=!1,this.$6&&(this.$2=s.setTimeout(function(){e.$10()},8e3))},t.onConnectSuccess=function(){},t.onConnectionLost=function(){this.$9()},t.onSubscribe=function(e){"/t_ms"===e&&(this.$3=!0)},t.onUnsubscribe=function(){},t.onPublish=function(e){("/messenger_sync_get_diffs"===e||"/messenger_sync_create_queue"===e)&&(this.$4=!0,this.$3&&(this.$5=!0,this.$9()))},t.onMessage=function(){},t.onWSFatal=function(){},t.$9=function(){this.$2&&(s.clearTimeout(this.$2),this.$2=null)},t.$10=function(){if(!1===this.$4){var e=1===this.$7?"no_iris_session_initialConnect":"no_iris_session";this.$1.bumpCounter(e),this.$1.eventLogMiscellaneousError({errorMessage:e}),this.$8()?this.$1.bumpCounter(e+".withProvider"):this.$1.bumpCounter(e+".withoutProvider"),!0===this.$3?this.$1.bumpCounter(e+".withTopicSubscribe"):this.$1.bumpCounter(e+".withoutTopicSubscribe")}!1===this.$3&&this.$1.bumpCounter("no_iris_topic_subscribe"),!0===this.$3&&!0===this.$4&&!1===this.$5&&this.$1.bumpCounter("session_before_topic_subscribe")},e}(),r.exports=e},null),__d("PolarisMqttAnalyticsHook",["PolarisMqttEnv","PolarisODS"],function(e,t,n,i,r,s,o){"use strict";e=function(){function e(){this.$1=n("PolarisMqttEnv").Env.getLoggerInstance(),this.$2=0,this.$3=0,this.$4=0,this.$5=0,n("PolarisODS").incr("web.mqtt.session_start"),n("PolarisMqttEnv").Env.isUserLoggedInNow()||n("PolarisODS").incr("web.mqtt.session_start.logout")}var t=e.prototype;return t.onConnectAttempt=function(){n("PolarisODS").incr("web.mqtt.ws_connect_attempt")},t.onConnectFailure=function(){this.$3++,n("PolarisODS").incr("web.mqtt.ws_connect_failure")},t.onConnected=function(){n("PolarisODS").incr("web.mqtt.ws_connect_connected")},t.onConnectSuccess=function(){0===this.$2&&n("PolarisODS").incr("web.mqtt.ws_connect_first_success"),this.$2++,n("PolarisODS").incr("web.mqtt.ws_connect_success")},t.onConnectionLost=function(){n("PolarisODS").incr("web.mqtt.ws_disconnect")},t.onSubscribe=function(){},t.onUnsubscribe=function(){},t.onPublish=function(){n("PolarisODS").incr("web.mqtt.ws_publish")},t.onMessage=function(){n("PolarisODS").incr("web.mqtt.message_arrived")},t.onWSFatal=function(){n("PolarisODS").incr("web.mqtt.ws_fatal")},t.onPollRequestSent=function(){n("PolarisODS").incr("web.mqtt.polling_request_send")},t.onPollRequestSuccess=function(){n("PolarisODS").incr("web.mqtt.polling_request_succeed"),0===this.$4&&n("PolarisODS").incr("web.mqtt.polling_first_success"),this.$4++},t.onPollResponse=function(){n("PolarisODS").incr("web.mqtt.lp.message_arrived")},t.onPollFinish=function(){},t.onPollRequestFailed=function(){n("PolarisODS").incr("web.mqtt.polling_request_failed"),this.$5++},e}(),o["default"]=e},98),__d("PolarisMqttConnectionHookCollection",[],function(e,t,n,i,r,s){"use strict";e=function(){function e(){this.$1=new Set}var t=e.prototype;return t.addHook=function(e){this.$1.add(e)},t.removeHook=function(e){this.$1["delete"](e)},t.onConnectAttempt=function(){this.$1.forEach(function(e){e.onConnectAttempt()})},t.onConnectFailure=function(){this.$1.forEach(function(e){e.onConnectFailure()})},t.onConnected=function(){this.$1.forEach(function(e){e.onConnected()})},t.onConnectSuccess=function(){this.$1.forEach(function(e){e.onConnectSuccess()})},t.onConnectionLost=function(){this.$1.forEach(function(e){e.onConnectionLost()})},t.onSubscribe=function(e){this.$1.forEach(function(t){t.onSubscribe(e)})},t.onUnsubscribe=function(e){this.$1.forEach(function(t){t.onUnsubscribe(e)})},t.onPublish=function(e){this.$1.forEach(function(t){t.onPublish(e)})},t.onMessage=function(e){this.$1.forEach(function(t){t.onMessage(e)})},t.onWSFatal=function(){this.$1.forEach(function(e){e.onWSFatal()})},e}(),s["default"]=e},66),__d("PolarisMqttProtocolUtils",["PolarisMqttEnv"],function(e,t,n,i,r,s){"use strict";function e(e,t){if(null==e)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function n(e,t){t=t;var n,i=0,r=1;do{if(t===e.length)return null;i+=(127&(n=e[t++]))*r,r*=128}while(0!=(128&n));return{value:i,offset:t}}function i(e){e=e;for(var t=new Array(1),n=0;n<4;n++){var i=e%128;if(!((e>>=7)>0)){t[n]=i;break}t[n]=128|i}return t}function o(e,t,n){return n=n,t[n++]=e>>8,t[n++]=e%256,n}function s(e,t){return 256*e[t]+e[t+1]}function a(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e.charCodeAt(n);r<128?t+=1:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}function c(e,t,n,i){return u(e,n,i=o(t,n,i)),i+t}function u(e,t,n){n=n;for(var i=0,r=e.length;i<r;i++){var s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=192|s>>6,t[n++]=128|63&s):s<55296||s>=57344?(t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++i)),t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s)}}function l(e,t,n){for(var i=[],r=t,s=0;r<t+n;){var o=e[r++];if(o<128)i[s++]=String.fromCharCode(o);else if(o>191&&o<224){var a=e[r++];i[s++]=String.fromCharCode((31&o)<<6|63&a)}else if(o>239&&o<365){a=e[r++];var c=e[r++],u=e[r++];a=((7&o)<<18|(63&a)<<12|(63&c)<<6|63&u)-65536,i[s++]=String.fromCharCode(55296+(a>>10)),i[s++]=String.fromCharCode(56320+(1023&a))}else c=e[r++],u=e[r++],i[s++]=String.fromCharCode((15&o)<<12|(63&c)<<6|63&u)}return i.join("")}var h=t("PolarisMqttEnv").Env;t=function(){function e(e,t,n){this.$1=1e3*e,this.$4=t,this.$5=n,this.$3=!1}var t=e.prototype;return t.$6=function(){var e=this;this.$3?(this.$3=!1,this.$4(),this.$2=h.setTimeout(function(){e.$6()},this.$1)):this.$5()},t.reset=function(){var e=this;this.$3=!0,this.$2&&(h.clearTimeout(this.$2),this.$2=null),this.$1>0&&(this.$2=h.setTimeout(function(){e.$6()},this.$1))},t.cancel=function(){this.$2&&(h.clearTimeout(this.$2),this.$2=null)},e}(),r.exports={UTF8Length:a,convertStringToUTF8:u,concatBuffers:e,decodeMultiByteInt:n,convertUTF8ToString:l,encodeMultiByteInt:i,writeUInt16BE:o,readUInt16BE:s,writeString:c,Pinger:t}},null),__d("PolarisMqttUtils",["PolarisMqttEnv"],function(e,t,n,i,r){"use strict";var s=t("PolarisMqttEnv").Env,o=t("PolarisMqttEnv").MqttGkNames;n={endpointWithSessionId:function(e,t){return s.genGk(o.mqtt_ep_with_sid)?this.endpointWithExtraParameter(e,"sid",t.toString()):e},endpointWithExtraParameters:function(e,t){var n=this,i=e;return t.forEach(function(e,t){i=n.endpointWithExtraParameter(i,t,e)}),i},endpointWithExtraParameter:function(e,t,n){return e.indexOf("?")>0?e+"&"+t+"="+n:e+"?"+t+"="+n},generateSessionId:function(){return Math.floor(s.random()*Number.MAX_SAFE_INTEGER)},promiseDone:function(e,t,n){(arguments.length>1?e.then(t,n):e).then(null,function(e){s.setTimeout(function(){throw e instanceof Error?e:new Error("promiseDone")},0)})},sprintf:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=0;return e.replace(/%s/g,function(){return String(n[r++])})},hasWSSupport:function(){return"WebSocket"in e&&null!==e.WebSocket}},r.exports=n},null),__d("PolarisMqttProtocolCodec",["PolarisMqttProtocolUtils","PolarisMqttUtils"],function(e,t,n,i,r,s){"use strict";function o(e,t){var n,i=t=t,r=e[t],s=r>>4,o=l(e,t+=1);if(null==o)return{wireMessage:null,position:i};if((o=(t=o.offset)+o.value)>e.length)return{wireMessage:null,position:i};switch(s){case b.CONNACK:i=!!(1&(i=e[t++]));var a=e[t++];n=new E(i,a);break;case b.PUBLISH:a=(i=15&r)>>1&3,r=d(e,t);var c=u(e,t+=2,r);t+=r,r=null,1===a&&(r=d(e,t),t+=2);var h=S.createWithBytes(e.subarray(t,o));n=new m(c,h,a,r,1==(1&i),i=8==(8&i));break;case b.PINGREQ:n=new _("PINGREQ");break;case b.PINGRESP:n=new _("PINGRESP");break;case b.PUBACK:case b.UNSUBACK:c=d(e,t),n=new P(s===b.PUBACK?"PUBACK":"UNSUBACK",c);break;case b.SUBACK:h=d(e,t),t+=2,a=e.subarray(t,o),n=new v(h,a);break;default:throw new Error(f("Invalid MQTT message type %s.",s))}return{wireMessage:n,position:o}}function e(e){for(var t=[],n=0;n<e.length;){var i=o(e,n),r=i.wireMessage;if(n=i.position,!r)break;t.push(r)}return i=null,n<e.length&&(i=e.subarray(n)),{messages:t,remaining:i}}var a=(n=t("PolarisMqttProtocolUtils")).UTF8Length,c=n.convertStringToUTF8,u=n.convertUTF8ToString,l=n.decodeMultiByteInt,h=n.encodeMultiByteInt,d=n.readUInt16BE,p=n.writeString,$=n.writeUInt16BE,f=t("PolarisMqttUtils").sprintf,b=Object.freeze({CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14}),g=[0,6,77,81,73,115,100,112,3],_=function(e){function t(t){return e.call(this,t)||this}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=new ArrayBuffer(2);return new Uint8Array(e)[0]=(15&this.messageType)<<4,e},t}(i=function(){function e(e){this.messageType=b[e]}return e.prototype.encode=function(){throw new TypeError("Cannot abstract class WireMessage")},e}());s=function(e){function t(){return e.call(this,"DISCONNECT")||this}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=(15&this.messageType)<<4,t=new ArrayBuffer(2),n=new Uint8Array(t);return n[0]=e,n.set(h(0),1),t},t}(i);var v=function(e){function t(t,n){var i;return(i=e.call(this,"SUBACK")||this).messageIdentifier=t,i.returnCode=n,i}return babelHelpers.inheritsLoose(t,e),t}(i),E=function(e){function t(t,n){var i;return(i=e.call(this,"CONNACK")||this).sessionPresent=t,i.returnCode=n,i}return babelHelpers.inheritsLoose(t,e),t}(i),P=function(e){function t(t,n){return(t=e.call(this,t)||this).messageIdentifier=n,t}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=(15&this.messageType)<<4,t=2,n=h(t),i=n.length+1;t=new ArrayBuffer(t+i);var r=new Uint8Array(t);return r[0]=e,r.set(n,1),i=$(this.messageIdentifier,r,i),t},t}(i);n=function(e){function t(t,n){var i;return(i=e.call(this,"CONNECT")||this).clientId=t,i.connectOptions=n,i}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=(15&this.messageType)<<4,t=g.length+3;t+=a(this.clientId)+2,t+=a(this.connectOptions.userName)+2;var n=h(t);t=new ArrayBuffer(1+n.length+t);var i=new Uint8Array(t);return i[0]=e,e=1,i.set(n,1),e+=n.length,i.set(g,e),e+=g.length,n=130,i[e++]=n,e=$(this.connectOptions.keepAliveInterval,i,e),e=p(this.clientId,a(this.clientId),i,e),e=p(this.connectOptions.userName,a(this.connectOptions.userName),i,e),t},t}(i),t=function(e){function t(t,n,i,r){var s;if((s=e.call(this,t)||this).topic=n,i<0&&i>1||1===i&&null==r)throw new TypeError(f("Argument Invalid. qos: %s messageType: %s.",i,t));return s.qos=i,s.messageIdentifier=r,s}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=(15&this.messageType)<<4;e|=2;var t=a(this.topic),n=2+t+2;this.messageType===b.SUBSCRIBE&&(n+=1);var i=h(n);n=new ArrayBuffer(1+i.length+n);var r=new Uint8Array(n);return r[0]=e,e=1,r.set(i,1),e+=i.length,null!=this.messageIdentifier&&(e=$(this.messageIdentifier,r,e)),e=p(this.topic,t,r,e),this.messageType===b.SUBSCRIBE&&null!=this.qos&&(r[e++]=this.qos),n},t}(i);var S=function(){function e(e,t){this.payloadString=e,this.payloadBytes=t}e.createWithString=function(t){var n=new Uint8Array(new ArrayBuffer(a(t)));return c(t,n,0),new e(t,n)},e.createWithBytes=function(t){for(var n=0,i=t.length;n<t.length&&123!==t[n]&&91!==t[n];)n++,i--;return new e(u(t,n,i),t=t.subarray(n,i))};var t=e.prototype;return t.string=function(){return this.payloadString},t.bytes=function(){return this.payloadBytes},e}(),m=function(e){function t(t,n,i,r,s,o){var a;if((a=e.call(this,"PUBLISH")||this).topic=t,a.payloadMessage=n,a.qos=i,a.messageIdentifier=r,a.retained=null!=s&&s,a.duplicate=null!=o&&o,1===a.qos&&null==a.messageIdentifier)throw new TypeError("Argument Invalid. messageIdentifier: null and qos: 1");return a}return babelHelpers.inheritsLoose(t,e),t.prototype.encode=function(){var e=(15&this.messageType)<<4;this.duplicate&&(e|=8),e=e|=this.qos<<1,this.retained&&(e|=1);var t=a(this.topic),n=t+2;n+=null==this.messageIdentifier?0:2;var i=this.payloadMessage.bytes();n+=i.byteLength;var r=h(n);n=new ArrayBuffer(1+r.length+n);var s=new Uint8Array(n);return s[0]=e,s.set(r,1),e=1+r.length,e=p(this.topic,t,s,e),null!=this.messageIdentifier&&(e=$(this.messageIdentifier,s,e)),s.set(i,e),n},t}(i);r.exports={MESSAGE_TYPE:b,WireMessage:{Base:i,PubAckUnsubAck:P,Ping:_,ConnAck:E,Connect:n,Disconnect:s,Subscription:t,Publish:m},createMessageWithString:S.createWithString,decodeMessage:o,decodeByteMessages:e}},null),__d("PolarisMqttTypes",[],function(e,t,n,i,r){"use strict";e=function(e,t){this.errorCode=e,this.errorMessage=t},t=function(e,t){this.mqttError=e,this.connAck=t},n=function(e){function t(t,n,i){return void 0===i&&(i=null),(n=e.call(this,n)||this).isRecoverable=t,n.originalError=i,n}return babelHelpers.inheritsLoose(t,e),t}(babelHelpers.wrapNativeSuper(Error)),r.exports={MqttError:e,MqttChannelError:n,ConnectFailure:t}},null),__d("PolarisMqttProtocolClient",["PolarisMqttEnv","PolarisMqttProtocolCodec","PolarisMqttProtocolUtils","PolarisMqttTypes"],function(e,t,n,i,r){"use strict";var s=t("PolarisMqttEnv").Env,o=(e=t("PolarisMqttProtocolCodec")).MESSAGE_TYPE,a=e.WireMessage,c=e.createMessageWithString,u=e.decodeByteMessages,l=t("PolarisMqttProtocolUtils").Pinger,h=t("PolarisMqttProtocolUtils").concatBuffers,d=t("PolarisMqttTypes").ConnectFailure;n=t("PolarisMqttTypes").MqttError;var p=30,$=6e4,f={SOCKET_ERROR:new n(1,"Socket error"),
SOCKET_MESSAGE:new n(2,"Unable to parse invalid socket message"),INVALID_DATA_TYPE:new n(3,"Received non-arraybuffer from socket."),CONNECT_TIMEOUT:new n(4,"Connect timed out"),CONNACK_FAILURE:new n(5,"Connection failure due to connack"),PING_TIMEOUT:new n(6,"Ping timeout"),APP_DISCONNECT:new n(7,"Disconnect initiated by app"),SERVER_DISCONNECT:new n(8,"Disconnect message sent my server"),SOCKET_CLOSE:new n(9,"Socket connection closed")};i=function(){function e(e){var t=this;this.handleMessage=function(e){switch(e.messageType){case o.CONNACK:if(null!=t.$7&&(s.clearTimeout(t.$7),t.$7=null),e instanceof a.ConnAck){var n=e;if(0!==n.returnCode)return t.$9.bumpCounter("protocol.error.connack.invalidreturncode"),t.setConnected(!1),void t.$11(f.CONNACK_FAILURE,n.returnCode);s.scheduleCallback(function(){t.$2.onConnectSuccess()}),null!=t.$8&&t.$8.reset()}break;case o.PUBLISH:if(e instanceof a.Publish){var i=e;s.scheduleCallback(function(){t.$2.onMessageArrived(i.topic,i.payloadMessage.payloadString)}),n=i.messageIdentifier,t.$9.bumpCounter("protocol.publish.received"),1===i.qos&&null!=n&&(n=new a.PubAckUnsubAck("PUBACK",n),t.$12(n))}break;case o.PUBACK:if(e instanceof a.PubAckUnsubAck){var r=(n=e).messageIdentifier;t.$9.bumpCounter("protocol.puback.received"),s.scheduleCallback(function(){t.$2.onMessageDelivered("",r)})}break;case o.PINGRESP:null!=t.$8&&t.$8.reset();break;case o.DISCONNECT:t.$11(f.SERVER_DISCONNECT);break;case o.SUBACK:t.$9.bumpCounter("protocol.suback.received");break;case o.UNSUBACK:t.$9.bumpCounter("protocol.unsuback.received");break;default:t.$9.logError(new Error("MqttProtocolClient: Received unhandled message type: "+e.messageType),"Received unhandled message type"),t.$9.bumpCounter("protocol.error.handlemessage.unsupportedtype")}},this.$3=e,this.$2={userName:"",mqttVersion:3,keepAliveInterval:10,ignoreSubProtocol:!1,onConnectSuccess:function(){},onConnectFailure:function(){},onConnection:function(){},onConnectionError:function(){},onConnectionLost:function(){},onMessageArrived:function(){},onMessageDelivered:function(){}},this.$1="mqttwsclient",this.$4=0,this.$5=!1,this.$9=s.getLoggerInstance()}var t=e.prototype;return t.connect=function(e){var t=this;if(this.$5)throw new Error("Invalid state: connect - already connected");this.$2=e,this.setConnected(!1),null!=this.$7&&(s.clearTimeout(this.$7),this.$7=null),this.$7=s.setTimeout(function(){t.$9.bumpCounter("protocol.error.connect.timeout"),t.$11(f.CONNECT_TIMEOUT)},1e3*p),this.$6=s.createSocket(this.$3),this.$6.binaryType="arraybuffer",this.$6.onopen=function(){t.setConnected(!0),t.$12(new a.Connect(t.$1,e)),e.onConnection()},this.$6.onmessage=function(e){if(!((e=e.data)instanceof ArrayBuffer))return t.$9.bumpCounter("protocol.error.onmessage.type"),void t.$11(f.INVALID_DATA_TYPE);try{e=new Uint8Array(e),null!=t.$10&&(e=h(t.$10,e),t.$9.bumpCounter("protocol.debug.usingMessagesBuffer"),delete t.$10,t.$10=null);var n=(e=u(e)).messages;for(t.$10=e.remaining,e=0;e<n.length;e++)t.handleMessage(n[e])}catch(e){t.$10=null,t.$9.logError(e,f.SOCKET_MESSAGE.errorMessage),t.$9.bumpCounter("protocol.error.onmessage.parse"),t.$11(f.SOCKET_MESSAGE)}},this.$6.onerror=function(){t.$9.bumpCounter("protocol.error.socket"),t.$11(f.SOCKET_ERROR)},this.$6.onclose=function(){t.$9.bumpCounter("protocol.socket.close"),t.$11(f.SOCKET_CLOSE)},null!=this.$8&&this.$8.cancel(),this.$8=new l(e.keepAliveInterval,this.$12.bind(this,new a.Ping("PINGREQ")),this.$11.bind(this,f.PING_TIMEOUT))},t.$13=function(){this.setConnected(!1),null!=this.$8&&this.$8.cancel(),null!=this.$7&&(s.clearTimeout(this.$7),this.$7=null),null!=this.$6&&(this.$6.onopen=function(){},this.$6.onmessage=function(){},this.$6.onerror=function(){},this.$6.onclose=function(){},this.$6.readyState===this.$6.OPEN&&this.$6.close(),delete this.$6,this.$6=null),this.$2.onConnectSuccess=function(){},this.$2.onConnectFailure=function(){},this.$2.onConnection=function(){},this.$2.onConnectionError=function(){},this.$2.onConnectionLost=function(){},this.$2.onMessageArrived=function(){},this.$2.onMessageDelivered=function(){}},t.disconnect=function(){null!=this.$6&&this.$6.readyState===this.$6.OPEN&&this.$5?(this.$12(new a.Disconnect),this.$9.bumpCounter("protocol.debug.disconnect"),this.$11(f.APP_DISCONNECT)):this.$13()},t.isConnected=function(){return this.$5},t.setConnected=function(e){this.$5=e},t.subscribe=function(e){if(!this.$5)throw this.$9.bumpCounter("protocol.error.subscribe.notconnected"),new Error("Invalid state: subscribe - not connected");this.$9.bumpCounter("protocol.subscribe."+e),e=new a.Subscription("SUBSCRIBE",e,0,this.$14()),this.$12(e)},t.unsubscribe=function(e){if(!this.$5)throw this.$9.bumpCounter("protocol.error.unsubscribe.notconnected"),new Error("Invalid state: unsubscribe - not connected");this.$9.bumpCounter("protocol.unsubscribe."+e),e=new a.Subscription("UNSUBSCRIBE",e,0,this.$14()),this.$12(e)},t.publish=function(e,t,n){this.$5||this.$9.bumpCounter("protocol.error.publish.notconnected"),this.$9.bumpCounter("protocol.publish."+e);var i=this.$14();return e=new a.Publish(e,c(t),n,i),this.$12(e),i},t.$14=function(){return++this.$4===$&&(this.$4=1),this.$4},t.$11=function(e,t){var n=this.$5,i=this.$2,r=i.onConnectFailure,o=i.onConnectionLost;this.setConnected(!1),n?s.scheduleCallback(function(){o(e)}):s.scheduleCallback(function(){r(new d(e,null!=t?t:-1))}),this.$13()},t.$12=function(e){var t=this.$6;null!=t&&t.readyState===t.OPEN&&t.send(e.encode())},e}(),r.exports=i},null),__d("PolarisMqttUserName",[],function(e,t,n,i,r,s){"use strict";e=function(){function e(e,t,n,i,r,s,o){this.$1=e,this.$2=t,this.$3=n,this.$4=i,this.$5=r,this.$6=s,this.$8=o,this.$7="object"==typeof document&&document&&document.hasFocus()}var t=e.prototype;return t.gen=function(e,t,n){return e={u:this.$1,s:e,cp:this.$3,ecp:this.$2,chat_on:this.$6,fg:this.$7,d:this.$4,ct:"cookie_auth",mqtt_sid:"",aid:this.$5,st:t,pm:n,dc:"",no_auto_fg:!0,asi:void 0,a:navigator.userAgent},this.$8&&this.$8.appSpecificInfo&&(e.asi=this.$8.appSpecificInfo),JSON.stringify(e)},t.setForegroundState=function(e){this.$7=e},t.setChatVisibility=function(e){this.$6=e},e}(),s["default"]=e},66),__d("PolarisMqttConnection",["PolarisMqttConnectionHookCollection","PolarisMqttEnv","PolarisMqttProtocolClient","PolarisMqttTypes","PolarisMqttUserName","PolarisMqttUtils","PolarisODS","Promise"],function(e,t,n,i,r,s,o){"use strict";function a(){}var c=10,u="publish",l="subscribe",h="unsubscribe",d=18e4,p=5e3,$=15,f=21;e=function(){function e(e,t){var i=this;this.$41=function(e){var t=new Set(e);t.forEach(function(e){i.$14.has(e)||i.unsubscribe(e)}),(e=new Set(i.$14)).forEach(function(e){t.has(e)||i.subscribe(e)})},this.$38=function(e,t){try{n("PolarisODS").incr("web.mqtt.js_error_in_init");var r=e?e.message:"error";i.$10.debugTrace("onError",t+": "+r),i.$2(e)}catch(e){n("PolarisODS").incr("web.mqtt.js_error_in_error_logging"),i.$10.logError(e,"JS error while trying to log previous error")}},this.$8=!1,this.$10=n("PolarisMqttEnv").Env.getLoggerInstance(),this.$11="Disconnected",this.$14=new Set,this.$15=new Map,this.$17=0,this.$18=0,this.$12=0,this.$13=0,this.$8=!1,this.$5="",this.$6=new(n("PolarisMqttUserName"))(0,0,1,"",0,!0),this.$9=0,this.$7=null,t=function(){},this.$1=t,this.$2=t,this.$3=t,this.$19=new(n("PolarisMqttConnectionHookCollection")),this.$4=function(){return[]},this.$16=e}var i=e.prototype;return i.run=function(e){var t=this,n=e.endpoint,i=e.extraConnectMessageProvider,r=e.mqttUserName,s=e.onJSError,o=e.onMessageReceived,c=e.onStateChange;e=e.subscribedTopics,this.$8?this.$10.debugTrace("run","Run called while in running state."):(this.$1=c,this.$3=o,this.$5=n,this.$6=r,this.$8=!0,this.$12=0,this.$2=s||a,e&&e.forEach(function(e){return t.$14.add(e)}),this.$4=i,this.$20(),this.$21())},i.shutdown=function(){this.$22(),this.$23("shutdown"),this.$8=!1,this.$10.debugTrace("shutdown","Shutdown")},i.subscribe=function(e){return this.$14.add(e),this.ensureConnected(l)&&this.$24(e),!0},i.publish=function(e,n,i){var r={resolve:function(){},reject:function(){}},s=new(t("Promise"))(function(e,t){r.resolve=e,r.reject=t}),o=this.ensureConnected(u),a="connection_unknown";return o?a=!0===(n=this.$25(e,n,i,r))?"connection_published":"connection_failed":(a="connection_not_connected",r.reject(new Error("Client disconnected"))),this.$10.eventLogPublish({sessionID:this.$9,topic:e,connectionStatus:o,publishStatus:a}),s},i.unsubscribe=function(e){return this.$14["delete"](e),this.ensureConnected(h)&&this.$26(e),!0},i.addHook=function(e){this.$19.addHook(e)},i.removeHook=function(e){this.$19.removeHook(e)},i.isRunning=function(){return this.$8},i.getSessionId=function(){return this.$9},i.ensureConnected=function(e){return this.$8?null==this.$7?(this.$10.debugTrace("ensureConnected","Mqtt connection: "+e+" called when not connected, ignored"),!1):!!this.$7.isConnected()||(this.$10.debugTrace("ensureConnected","Mqtt connection: "+e+" called with client not connected"),!1):(this.$10.debugTrace("ensureConnected","Mqtt connection: "+e+" called when not running"),!1)},i.connectionState=function(){return this.$11},i.testOnlyGetSubscribedTopics=function(){return this.$14},i.$20=function(){var e=this;n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_send_unload_event)&&"undefined"!=typeof window&&window.addEventListener("unload",function(t){return e.$27(t)})},i.$27=function(){this.publish("/browser_close","{}",0)},i.$22=function(){this.$8&&null!=this.$7&&(this.$28("Disconnected"),null!=this.$7&&this.$7.disconnect(),this.$7=null)},i.$28=function(e){e!==this.$11&&(this.$11=e,this.$1(e))},i.$21=function(){var e=this;if(this.$8){this.$28("Connecting");var t=Date.now();this.$9=n("PolarisMqttUtils").generateSessionId();var i=Array.from(this.$14),r=n("PolarisMqttUtils").endpointWithSessionId(this.$5,this.$9);try{this.$7=new(n("PolarisMqttProtocolClient"))(r);var s=this.$29(),o=s.map(function(e){return e.topic});r=this.$6.gen(this.$9,i,s),null!=this.$7&&(this.$7.connect({userName:r,mqttVersion:3,keepAliveInterval:c,ignoreSubProtocol:!0,onConnectFailure:function(n){return e.$30(n,t,i,o)},onConnectSuccess:function(){return e.$31(t,i,o)},onConnection:function(){return e.$32(s,i)},onConnectionError:function(t){return e.$33(t)},onConnectionLost:function(t){return e.$34(t)},onMessageArrived:function(t,n){return e.$35(t,n)},onMessageDelivered:function(t,n){return e.$36(t,n)}}),n("PolarisODS").incr("web.mqtt.protocol.connectattempt"),this.$19.onConnectAttempt())}catch(e){n("PolarisODS").incr("web.mqtt.js_error_in_init_exception"),this.$28("Disconnected"),this.$37(!1,t,i,[],14,e.message),e&&this.$10.logErrorWarn(e,"ws_js_error"),this.$19.onWSFatal(),this.$38(new(n("PolarisMqttTypes").MqttChannelError)(!1,"ws_js_error",e),"client_init")}}},i.$29=function(){var e=this.$4(),t=65536;return e.map(function(e){return e.messageId=t--,e})},i.$24=function(e){try{if(null!=this.$7)return this.$7.subscribe(e),this.$10.debugTrace("_doSubscribe","Subscribing to "+e),this.$19.onSubscribe(e),n("PolarisODS").incr("web.mqtt.protocol.subscribe"),!0}catch(e){this.$10.logError(e,"Exception subscribing"),n("PolarisODS").incr("web.mqtt.subscribe_exception"),n("PolarisODS").incr("web.mqtt.protocol.subscribe.error")}return!1},i.$26=function(e){try{if(null!=this.$7)return this.$7.unsubscribe(e),this.$10.debugTrace("_doUnsubscribe","Unsubscribing to "+e),this.$19.onUnsubscribe(e),n("PolarisODS").incr("web.mqtt.protocol.unsubscribe"),!0}catch(e){this.$10.logError(e,"Exception unsubscribing"),n("PolarisODS").incr("web.mqtt.unsubscribe_exception"),n("PolarisODS").incr("web.mqtt.protocol.unsubscribe.error")}return!1},i.$25=function(e,t,i,r){if(null==this.$7)return!1;try{t=this.$7.publish(e,t,i),n("PolarisODS").incr("web.mqtt.protocol.publish");var s=null!=t?t:"null";return this.$10.debugTrace("_doPublish","publish "+e+" with messageId:"+s+" qos:"+i),this.$19.onPublish(e),null!=t?this.$15.set(t,r):r.resolve(),!0}catch(e){return this.$10.logError(e,"Exception publishing"),n("PolarisODS").incr("web.mqtt.publish_exception"),r.reject(e),n("PolarisODS").incr("web.mqtt.protocol.publish.error"),!1}},i.$39=function(e){var t=this;void 0===e&&(e=null),this.$8&&(this.$22(),this.$23("reconnect"),this.$40(),this.$9=-1,this.$13=0,e=null!=e?e:Math.pow(2,Math.min(this.$12,6))*(1e3+200*n("PolarisMqttEnv").Env.random()),this.$10.debugTrace("_scheduleReconnect","Reconnect in "+e+" ms"),n("PolarisMqttEnv").Env.setTimeout(function(){t.$21()},e),this.$12+=1)},i.$40=function(){if(n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_ws_reconnect_reset)){var e=Date.now()-this.$13,t=0!==this.$13&&e>p,i=this.$12>$;(t||i)&&(this.$12=0),0!==this.$13&&e<=p&&n("PolarisODS").incr("web.mqtt.short_lived_session"),i&&n("PolarisODS").incr("web.mqtt.connection_attempt_limit")}},i.$37=function(e,t,n,i,r,s){!0===e?this.$18++:this.$17++,this.$10.eventLogConnect({sessionID:this.$9,connectionStatus:e,duration:Date.now()-t,hostname:this.$5,attemptNumber:this.$12,failTotal:this.$17,successTotal:this.$18,subscribedTopics:n,publishes:i,errorCode:r,errorMessage:s})},i.$30=function(e,t,i,r){var s=e.mqttError,o=s.errorMessage;this.$10.debugTrace("connect","Connect failed "+o),n("PolarisODS").incr("web.mqtt.protocol.onconnectfailure"),this.$19.onConnectFailure(),this.$37(!1,t,i,r,s.errorCode,o),null==e.connAck||(n("PolarisODS").incr("web.mqtt.protocol.connect_failure"),e.connAck!==f)?this.$39():this.$39(d)},i.$32=function(e,t){var i=this;n("PolarisODS").incr("web.mqtt.protocol.onconnection"),this.$10.debugTrace("Connect","Socket established"),this.$19.onConnected(),t.forEach(function(e){i.$19.onSubscribe(e)}),e.forEach(function(e){i.$19.onPublish(e.topic)}),this.$28("TransportConnected")},i.$31=function(e,t,i){n("PolarisODS").incr("web.mqtt.protocol.onconnectsuccess"),this.$10.debugTrace("connect","Connect success"),this.$19.onConnectSuccess(),this.$37(!0,e,t,i),this.$28("Connected"),this.$41(t),n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_ws_reconnect_reset)||(this.$12=0),this.$13=Date.now()},i.$34=function(e){n("PolarisODS").incr("web.mqtt.protocol.onconnectionlost"),e.errorCode&&this.$10.eventLogDisconnect({sessionID:this.$9,errorCode:e.errorCode,errorMessage:e.errorMessage,duration:Date.now()-this.$13}),this.$10.debugTrace("connect","connection lost"),this.$19.onConnectionLost(),this.$39()},i.$33=function(){},i.$35=function(e,t){n("PolarisODS").incr("web.mqtt.protocol.onmessagearrived"),this.$10.debugTrace("onMessageArrived","Message received on "+e),this.$19.onMessage(e);try{this.$3(e,t)}catch(e){this.$10.logError(e,"Listener threw error"),n("PolarisODS").incr("web.mqtt.listener_error")}},i.$36=function(e,t){n("PolarisODS").incr("web.mqtt.protocol.onmessagedelivered"),e=null!=t?t:"null",this.$10.debugTrace("onMessageDelivered","Delivered Message {ID: "+e+"}"),null!=t&&null!=(e=this.$15.get(t))&&(this.$15["delete"](t),e.resolve())},i.$23=function(e){this.$15.forEach(function(t){t.reject(new Error(e))}),this.$15.clear()},e}(),o["default"]=e},98),__d("PolarisMqttChannel",["PolarisChannelClientID","PolarisIrisSubscribeChecker","PolarisMqttAnalyticsHook","PolarisMqttConnection","PolarisMqttEnv","PolarisMqttUserName","PolarisMqttUtils","PolarisODS","Promise","uuid"],function(e,t,n,i,r,s,o){"use strict";var a=6e4;e=function(){function e(e){var t=this,i=e.appId,r=e.capabilities,s=e.chatVisibility;s=void 0===s||s;var o=e.clientCapabilities,a=e.debugId,c=e.endpoint,u=e.igSpecificOptions,l=e.initialSubscribedTopics,h=e.observer;e=e.userFbid,this.$8=n("PolarisMqttEnv").Env.getLoggerInstance(),this.$8.setAppId(i),this.$9=new(n("PolarisMqttUserName"))(e,r,o,n("PolarisChannelClientID").getID(),i,s,u),this.$1=c,this.$5="Disconnected",this.$2=[h],this.$4=new Set,this.$6=new Map,this.$7=new(n("PolarisMqttConnection"))(u,a),u&&u.deviceId?this.$3=u.deviceId:this.$3=n("uuid")(),this.$13=new(n("PolarisMqttAnalyticsHook")),this.$7.addHook(this.$13),this.$7.addHook(new(n("PolarisIrisSubscribeChecker"))(function(){return t.$4.size>0})),this.$10=!1,this.$12=new Map,this.$11=[],this.$14(l)}var i=e.prototype;return i.$14=function(e){var t=this;if(this.$7.isRunning())this.$15("run","Connection started calling run again");else{if(n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_ws_polling_enabled)){if(n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_ws_forced_polling_only))return void this.$15("MqttChannel","Websocket disabled, will do long polling only");if(!n("PolarisMqttUtils").hasWSSupport())return this.$15("MqttChannel","Websocket Unavailable, will do long polling only"),void n("PolarisODS").incr("web.mqtt.ws_unavailable_polling")}this.$7.run({onStateChange:function(e){t.$16(e)},onJSError:function(e){t.$17(e)},onMessageReceived:function(e,n){t.$18(e,n)},endpoint:this.$1,mqttUserName:this.$9,subscribedTopics:e,extraConnectMessageProvider:function(){return t.$19()}})}},i.shutdown=function(){this.$7&&this.$7.shutdown()},i.publish=function(e,t,n){return void 0===n&&(n={qos:1,skipBuffer:!1}),0===n.qos?this.$20(e,t):this.$21(e,t,n)},i.$20=function(e,t){return this.$7.publish(e,t,0)},i.$21=function(e,i,r){var s={resolve:function(){},reject:function(){}},o=new(t("Promise"))(function(e,t){s.resolve=e,s.reject=t}),a=n("PolarisMqttEnv").Env.random();return e={topic:e,payload:i,options:r,ack:s,publishToken:a,timeoutId:null},r.skipBuffer?"Connecting"===this.$7.connectionState()?this.$11.push(e):this.$22(e):(e.timeoutId=this.$23(a),this.$12.set(a,e),this.$24(e)),o},i.$22=function(e){n("PolarisMqttUtils").promiseDone(this.$7.publish(e.topic,e.payload,e.options.qos),function(){e.ack.resolve()},function(t){e.ack.reject(t)})},i.$24=function(e){var t=this;n("PolarisMqttUtils").promiseDone(this.$7.publish(e.topic,e.payload,e.options.qos),function(){return t.$25(e)},function(){})},i.subscribe=function(e,t){this.$7.subscribe(e);var n=this.$6.get(e);n?n.push(t):(n=[t],this.$6.set(e,n))},i.subscribeChannelEvents=function(e){this.$2.push(e)},i.registerExtraConnectPayloadProvider=function(e){var t=this;this.$4.add(e),this.$7.isRunning()&&(e=e.getPublishMessages()).forEach(function(e){t.publish(e.topic,e.payload,{qos:e.qos,skipBuffer:!0})})},i.unregisterExtraConnectPayloadProvider=function(e){this.$4["delete"](e)},i.unsubscribe=function(e){this.$7.unsubscribe(e),this.$6["delete"](e)},i.getConnectionState=function(){return this.$5},i.getEndpoint=function(){return this.$1},i.addHook=function(e){this.$7.addHook(e)},i.removeHook=function(e){this.$7.removeHook(e)},i.testOnlyMessageReceived=function(e,t){this.$18(e,t)},i.$26=function(e){var t=this.$12.get(e);null!=t&&null!=t.timeoutId&&n("PolarisMqttEnv").Env.clearTimeout(t.timeoutId),this.$12["delete"](e)},i.$23=function(e){var t=this;return n("PolarisMqttEnv").Env.setTimeout(function(e){var i=t.$12.get(e);if(i){var r=i.topic;n("PolarisODS").incr("web.mqtt.publish_timeout"),t.$8.debugTrace("publish_timeout","Timeout publishing topic: "+r+" publishToken: "+e),t.$26(e),i.ack.reject(new Error("Publish Timed Out"))}},a,e)},i.$25=function(e){var t=e.publishToken;this.$12.get(t)&&(this.$26(t),e.ack.resolve(),this.$8.debugTrace("publish_success","Topic: "+e.topic+" publishToken: "+e.publishToken),n("PolarisODS").incr("web.mqtt.publish_success"))},i.$18=function(e,t){if(i=this.$6.get(e)){e=i;var i,r=0;for(e=(i=Array.isArray(e))?e:e["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(i){if(r>=e.length)break;s=e[r++]}else{if((r=e.next()).done)break;s=r.value}s=s;try{s(t)}catch(e){this.$8.logError(e,"Listener exception"),n("PolarisODS").incr("web.mqtt.listener_error")}}}else this.$8.debugTrace("_onMessageReceived",e+" being dropped, no listeners")},i.$17=function(e){n("PolarisMqttEnv").Env.genGk(n("PolarisMqttEnv").MqttGkNames.mqtt_ws_polling_enabled)?e.isRecoverable?n("PolarisODS").incr("web.mqtt.recoverable_error_skipped"):n("PolarisODS").incr("web.mqtt.unrecoverable_error_skipped"):(e.isRecoverable?n("PolarisODS").incr("web.mqtt.recoverable_error_not_skipped"):n("PolarisODS").incr("web.mqtt.unrecoverable_error_not_skipped"),e.isRecoverable||(this.$10=!0),this.$27(e))},i.$27=function(e){var t=this.$2,n=Array.isArray(t),i=0;for(t=n?t:t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}(r=r).onJSError&&r.onJSError(e)}},i.$16=function(e){var t=this;"Connecting"===e?(this.$11.forEach(function(e){e.ack.reject(new Error("Client Reconnecting"))}),this.$11=[]):"TransportConnected"===e&&(this.$11.forEach(function(e){t.$22(e)}),this.$11=[],this.$12.forEach(function(e){t.$24(e)})),this.$5=this.$28(e),this.$15("_changeState","Connection state = "+e),this.$29()},i.$28=function(e){switch(e){case"Connecting":case"TransportConnected":return"Connecting";case"Connected":return"Connected";case"Disconnected":return"Disconnected"}throw new Error("Unknown state "+e)},i.$29=function(){var e=this.$2,t=Array.isArray(e),n=0;for(e=t?e:e["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var i;if(t){if(n>=e.length)break;i=e[n++]}else{if((n=e.next()).done)break;i=n.value}(i=i).onMQTTStateChanged(this.$5)}},i.$19=function(){var e=this,t=[];return this.$4.forEach(function(i){try{i=i.getPublishMessages(),Array.prototype.push.apply(t,i)}catch(t){e.$8.logError(t,"ConnectPayload provider exception"),n("PolarisODS").incr("web.mqtt.connectPayloadProvider_error")}}),t},i.$15=function(e,t){this.$8.debugTrace(e,"Mqtt channel: "+t)},i.setForegroundState=function(e){this.$9&&this.$9.setForegroundState(e)},i.setChatVisibility=function(e){this.$9&&this.$9.setChatVisibility(e)},e}(),o["default"]=e},98),__d("PolarisMqttLogger",["PolarisChannelClientID","PolarisDirectLogger","PolarisMqttEnv","PolarisODS"],function(e,t,n,i,r,s,o){"use strict";e="mqtt_client";var a=null,c=new(i("PolarisDirectLogger").DirectLogger)(e,n("PolarisChannelClientID").getID()),u={CONNECT:"mqtt_client_connect",DISCONNECT:"mqtt_client_disconnect",PUBLISH:"mqtt_client_publish",CLIENT_ERROR:"mqtt_client_error"};t=function(){function e(){this.$1=0,this.$2=Date.now(),this.$3=n("PolarisChannelClientID").getID()}e.getInstance=function(){return a||(a=new e),a};var t=e.prototype;return t.setAppId=function(e){0===this.$1&&(this.$1=e)},t.eventLogConnect=function(e){var t=e.attemptNumber,i=e.connectionStatus,r=e.duration,s=e.errorCode,o=e.errorMessage;e.failTotal;var a=e.hostname,c=e.publishes,l=e.sessionID,h=e.subscribedTopics;e.successTotal,i?n("PolarisODS").incr("web.mqtt.mqtt_client_connect.success"):n("PolarisODS").incr("web.mqtt.mqtt_client_connect.failed"),e={device_id:this.$3,session_id:l,logged_in:n("PolarisMqttEnv").Env.isUserLoggedInNow(),href:window.location.hostname,connection_status:i,duration:r,hostname:a,attempt_number:t,subscribed_topics:h,publishes:c,error_code:s,error_message:o},this.$4(u.CONNECT,e)},t.eventLogPull=function(e){var t=e.duration,i=e.errorMessage,r=e.hostname,s=e.pullEventName,o=e.sessionID;e=e.status,o={device_id:this.$3,session_id:o,logged_in:n("PolarisMqttEnv").Env.isUserLoggedInNow(),href:window.location.hostname,connection_status:e,duration:t,hostname:r,error_message:i},this.$4(s,o)},t.eventLogDisconnect=function(e){var t=e.duration,i=e.errorCode,r=e.errorMessage;e=e.sessionID,n("PolarisODS").incr("web.mqtt.mqtt_client_disconnect"),e={device_id:this.$3,session_id:e,href:window.location.hostname,duration:t,error_code:i,error_message:r},this.$4(u.DISCONNECT,e)},t.eventLogPublish=function(e){var t=e.connectionStatus,i=e.publishStatus,r=e.sessionID;e=e.topic,n("PolarisODS").incr("web.mqtt.mqtt_client_publish"),r={device_id:this.$3,href:window.location.hostname,session_id:r,topic:e,connection_status:t,publish_status:i},this.$4(u.PUBLISH,r)},t.logError=function(e,t){n("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){c.logError(t,e)})},t.eventLogMiscellaneousError=function(e){e=e.errorMessage,e={device_id:this.$3,logged_in:n("PolarisMqttEnv").Env.isUserLoggedInNow(),href:window.location.hostname,error_message:e,time_passed:Date.now()-this.$2},this.$4(u.CLIENT_ERROR,e)},t.logErrorWarn=function(e,t){n("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){c.logError(t,e)})},t.logWarn=function(){},t.debugTrace=function(e,t){n("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){c.debugTrace(e,t)})},t.bumpCounter=function(){},t.$4=function(e,t){var i=this;n("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){t.event_type=e,t.app_id=i.$1,t.online=i.$5(),c.logDirectEvent(e,t)})},t.$5=function(){return!(!window.navigator||void 0===window.navigator.onLine)&&window.navigator.onLine},e}(),o["default"]=t},98),__d("polarisSetTimeoutAcrossTransitions",[],function(e,t,n,i,r,s){"use strict";function e(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return setTimeout.apply(void 0,[e,t].concat(i))}s["default"]=e},66),__d("PolarisMqttEnvInitializer",["PolarisConfig","PolarisMqttEnv","PolarisMqttLogger","PolarisWebStorage","polarisSetTimeoutAcrossTransitions"],function(e,t,n,i,r,s,o){"use strict";var a="mqtt:";t={initialize:function(){i("PolarisMqttEnv").Env.initialize(null,i("PolarisConfig").isLoggedIn,null,n("polarisSetTimeoutAcrossTransitions"),function(){return n("PolarisMqttLogger").getInstance()},null,null,null,null,function(e,t){var i=n("PolarisWebStorage").getLocalStorage();return i&&null!=(i=i.getItem(a+e))?i:t},function(e,t){var i=n("PolarisWebStorage").getLocalStorage();i&&(null==t?i.removeItem(a+e):i.setItem(a+e,t))})}},o["default"]=t},98),__d("polarisArraySplitChunks",[],function(e,t,n,i,r,s){"use strict";function e(e,t){for(var n=[],i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}s["default"]=e},66),__d("polarisNextTick",[],function(e,t,n,i,r,s){"use strict";t=process&&"function"==typeof process.nextTick?function(e){process.nextTick(e)}:"function"==typeof setImmediate?function(e){setImmediate(e)}:"function"==typeof window.setTimeout?function(e){window.setTimeout(e,0)}:function(e){e()},s["default"]=t},66),__d("polarisForEachAsync",["Promise","polarisNextTick"],function(e,t,n,i,r,s,o){"use strict";function e(e,i){return new(t("Promise"))(function(t,r){function s(){try{i(e[o])}catch(e){return void r(e)}++o>=e.length?t():n("polarisNextTick")(s)}var o=0;0!==e.length?s():t()})}o["default"]=e},98),__d("PolarisDirectMQTT",["PolarisBaseGraphQLEventHandler","PolarisCallGatingHelpers","PolarisConfig","PolarisDeviceOrMachineId","PolarisDirectConstants","PolarisDirectDeltaHandlers","PolarisDirectGraphQLSubscription","PolarisDirectIrisSubscription","PolarisDirectLogger","PolarisDirectSkywalkerSubscription","PolarisLiveDeltaHandler","PolarisMediaOverlayInfoTypes","PolarisMqttChannel","PolarisMqttEnvInitializer","PolarisODS","PolarisReactRedux","nullthrows","polarisArraySplitChunks","polarisDeveloperSettings","polarisForEachAsync","polarisGenerateOfflineThreadingId","randomInt"],function(e,t,n,i,r,s,o){"use strict";var a=20;e=function(){function e(e,t){var r=this;this.$8=0,this.$14=function(e){var t;try{t=JSON.parse(e.substr(0,e.length-1))}catch(e){return void r.$4.logError("Could not parse mqttMessages",e)}if(4===(e=t.payload.header).type&&e.conferenceName.includes("ROOM")){var i,s;i=(null==(i=t.payload.body)?void 0:null==(i=i.ringRequest)?void 0:i.ringType)%2==1;var o="",a="",c="",u=[];if(s=null==(s=t.payload.body)?void 0:null==(s=s.ringRequest)?void 0:null==(s=s.appMessages)?void 0:s.find(function(e){return"ring_data"===e.body.genericMessage.topic})){var l=(s=JSON.parse(null==s?void 0:null==(s=s.body)?void 0:null==(s=s.genericMessage)?void 0:s.data)).display_name,h=s.display_uri,d=s.group_name,p=s.ig_thread_id;if(s=s.participant_usernames,o=p,c=l,u.push(h),d)a=d;else{try{s=JSON.parse(s)}catch(e){}a=Array.isArray(s)?[l].concat(s).join(", "):l}}r.$6(e.type,e.serverInfoData,o,i,a,u,c),n("PolarisODS").incr("web.rtc.ack_ring_message"),r.$15(e.conferenceName,e.sequenceNumber,e.serverInfoData,e.transactionId,e.type,e.conferenceType)}else 5===e.type&&e.conferenceName.includes("ROOM")?(r.$6(e.type,e.serverInfoData,"",!1,"",[],""),n("PolarisODS").incr("web.rtc.ack_dismiss_message"),r.$15(e.conferenceName,e.sequenceNumber,e.serverInfoData,e.transactionId,e.type,e.conferenceType)):n("PolarisODS").incr("web.rtc.rtc_message_ignored")},this.$15=function(e,t,i,s,o,a){if(null==r.$7){var c=n("randomInt")(0,4294967294)+1;r.$7=String(c)}c={endpoint:{appId:r.$12(),deviceId:r.$13(),userId:r.$11()},jsonPayload:{header:{clientSessionId:r.$7,clientStack:5,conferenceType:a,conferenceName:e,messageTags:[],responseStatusCode:200,retryCount:0,sequenceNumber:t,serverInfoData:i,transactionId:s,type:o},body:{ringResponse:{deviceCapabilities:[],deviceStatus:0}}}},n("nullthrows")(r.$5).publish("/rtc_multi",JSON.stringify(c))["catch"](function(e){var t;throw 4===o?n("PolarisODS").incr("web.rtc.ack_ring_message_failed"):5===o?n("PolarisODS").incr("web.rtc.ack_dismiss_message_failed"):n("PolarisODS").incr("web.rtc.ack_message_failed"),t=null!=(t=null==(t=r.$5)?void 0:t.getConnectionState())?t:"Unknown",r.$4.logError("ack_rtc_message_failed",e,{message_type:o,conference_type:a,mqtt_state:t}),e})},this.$16=function(e){var t,s=n("nullthrows")(r.$1);try{t=JSON.parse(e)}catch(e){return void r.$4.logError("Could not parse mqttMessages",e)}Array.isArray(t)?n("polarisForEachAsync")(n("polarisArraySplitChunks")(t,a),function(e){i("PolarisReactRedux").batch(function(){var t=e,n=Array.isArray(t),i=0;for(t=n?t:t["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var o;if(n){if(i>=t.length)break;o=t[i++]}else{if((i=t.next()).done)break;o=i.value}var a=(o=o).data,c=o.event,u=o.mutation_token;if(o=o.seq_id,r.$4.debugTrace("parsed_message",{event:c,mutation_token:u}),"patch"!==c)return void r.$4.debugTrace("skipped_message",{event:c});if(!Array.isArray(a))return void r.$4.debugTrace("parsed_message_bad_operations",typeof a);c=a;var l=0;for(c=(a=Array.isArray(c))?c:c["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var h;if(a){if(l>=c.length)break;h=c[l++]}else{if((l=c.next()).done)break;h=l.value}h=h,s.handleDelta(h,u)}o&&(h=r.$2.subscription_type,r.$4.debugTrace("seq_id",{seq_id:o,subscriptionType:h}),"message"===h&&s.onSeqIdUpdated(o))}})}):r.$4.debugTrace("parsed_message_not_array",typeof t)},this.$17=function(e){try{var t;if("ok"===(e=JSON.parse(e)).status)null==(null==e?void 0:null==(t=e.payload)?void 0:t.activity_status)?r.$4.logDirectEvent("send_message_response_success"):r.$4.logDirectEvent("send_activity_response_success");else null==(null==e?void 0:null==(t=e.payload)?void 0:t.activity_status)?r.$4.logError("send_message_response_failed"):r.$4.logDirectEvent("send_activity_response_failed")}catch(e){r.$4.logError("send_message_response_parse_failed",e)}},this.$18=function(e){r.$4.debugTrace("state_changed",e);var t=n("nullthrows")(r.$1);if("Connected"===e){var s=n("nullthrows")(r.$5);s.subscribe("/ig_message_sync",r.$16),s.subscribe("/ig_send_message_response",r.$17),i("PolarisCallGatingHelpers").isIncomingCallEnabled()&&!i("PolarisCallGatingHelpers").isZenonIncomingRingEnabled()&&s.subscribe("/pubsub",r.$14),r.$3||(r.$3=new(i("PolarisDirectIrisSubscription").DirectIrisSubscription)(t,r.$2,s,r.$4.getDebugId())),r.$3.subscribe(),r.$10||(r.$10=new(i("PolarisDirectGraphQLSubscription").DirectGraphQLSubscription)(t,s,r.$4.getDebugId())),"message"===r.$2.subscription_type?(r.$9||(r.$9=new(i("PolarisDirectSkywalkerSubscription").DirectSkywalkerSubscription)(t,s,r.$4.getDebugId())),r.$9.subscribe(),r.$10&&r.$10.enableOrDisableEventHandlerByType(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE,!0)):(r.$4.debugTrace("skip_skywalker",r.$2),r.$10&&r.$10.enableOrDisableEventHandlerByType(i("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PRESENCE,!1)),r.$10&&r.$10.subscribe()}else"Disconnected"===e&&(r.$3&&(r.$3.unsubscribe(),r.$3=null),r.$9&&(r.$9.unsubscribe(),r.$9=null),r.$10&&(r.$10.unsubscribeGraphQL(),r.$10=null),(s=r.$5)&&(s.unsubscribe("/ig_message_sync"),s.unsubscribe("/ig_send_message_response"),i("PolarisCallGatingHelpers").isIncomingCallEnabled()&&!i("PolarisCallGatingHelpers").isZenonIncomingRingEnabled()&&s.unsubscribe("/pubsub")));t.onMqttConnectivityChanged(e)},this.$19=function(e){return r.$4.logDirectEvent("send_attempt",{action:e.action,type:e.item_type||""}),n("nullthrows")(r.$5).publish("/ig_send_message",JSON.stringify(babelHelpers["extends"]({client_context:n("polarisGenerateOfflineThreadingId")(),device_id:r.$13()},e)))["catch"](function(e){throw r.$4.logError("send_message_failed",e),e})},this.$4=new(i("PolarisDirectLogger").DirectLogger)("DirectMQTT",t),this.$4.debugTrace("ctor",e),this.$1=null,this.$2=e,this.$3=null,this.$5=null,this.$9=null,this.$10=null}var t=e.prototype;return t.$11=function(){return parseInt(n("nullthrows")(i("PolarisConfig").getViewerId()),10)},t.$12=function(){
return parseInt(i("PolarisConfig").getIGAppID(),10)},t.$13=function(){return i("PolarisDeviceOrMachineId").getDeviceOrMachineId()},t.sendRtcHangupRequest=function(e){var t=this;return e={endpoint:{appId:this.$12(),deviceId:this.$13(),userId:this.$11()},jsonPayload:{header:{clientSessionId:this.$7,clientStack:5,messageTags:[],retryCount:0,sequenceNumber:this.$8++,serverInfoData:e,transactionId:String(n("randomInt")(0,4294967294)+1),type:2},body:{hangupRequest:{detailedReasonString:"",reason:0}}}},n("nullthrows")(this.$5).publish("/rtc_multi",JSON.stringify(e))["catch"](function(e){throw t.$4.logError("send_rtc_hangup_message_failed",e),e})},t.sendTextMessage=function(e,t,n,r,s){return this.$19({action:"send_item",item_type:i("PolarisDirectConstants").ThreadItemType.TEXT,mutation_token:n,replied_to_item_id:r,replied_to_client_context:s,text:t,thread_id:e})},t.sendMediaShare=function(e,t,n){return(null==n?void 0:n.overlay_layout)===i("PolarisMediaOverlayInfoTypes").MEDIA_OVERLAY_LAYOUTS.MEDIA_COVER||(null==n?void 0:n.overlay_layout)===i("PolarisMediaOverlayInfoTypes").MEDIA_OVERLAY_LAYOUTS.MEDIA_COVER_WITH_BOTTOM_BANNER?this.$19({action:"send_item",item_type:i("PolarisDirectConstants").ThreadItemType.MEDIA_SHARE,media_id:t,thread_id:e,share_treatment_type:i("PolarisDirectConstants").InformTreatmentTypeValues.WARNING_SCREENS,share_treatment_title:i("PolarisDirectConstants").InformTreatmentTitleValues.FALLBACK}):this.$19({action:"send_item",item_type:i("PolarisDirectConstants").ThreadItemType.MEDIA_SHARE,media_id:t,thread_id:e})},t.sendLike=function(e,t){return this.$19({action:"send_item",item_type:i("PolarisDirectConstants").ThreadItemType.LIKE,mutation_token:t,thread_id:e})},t.indicateTypingActivity=function(e,t){return this.$19({action:"indicate_activity",thread_id:t,activity_status:e})},t.markVisualItemSeen=function(e,t){return this.$19({action:"mark_visual_item_seen",target_item_type:"voice_media",thread_id:t,item_ids:JSON.stringify([e])})},t.modifyLikeReaction=function(e,t,n,i,r){return this.$19({action:"send_item",item_id:e,item_type:"reaction",node_type:"item",reaction_status:i,reaction_type:"like",target_item_type:t,thread_id:n,emoji:null!=(e=r)?e:""})},t.disconnect=function(){this.$4.debugTrace("disconnect_start"),this.$3?(this.$4.debugTrace("unsubscribe_iris"),n("nullthrows")(this.$3).unsubscribe(),this.$3=null):this.$4.debugTrace("no_iris"),this.$9?(this.$4.debugTrace("unsubscribe_skywalker"),this.$9=null):this.$4.debugTrace("no_skywalker"),this.$10?(this.$4.debugTrace("unsubscribe_graphql"),this.$10=null):this.$4.debugTrace("no_graphql"),this.$5?(this.$4.debugTrace("shutdown_channel"),n("nullthrows")(this.$5).shutdown(),this.$5=null):this.$4.debugTrace("no_channel"),this.$1&&(this.$1=null),this.$4.debugTrace("disconnect_end")},t.connect=function(e,t){var r=this;this.$4.debugTrace("connect_start"),this.disconnect(),this.$1=new(i("PolarisDirectDeltaHandlers").DirectDeltaHandlers)(e,this.$4.getDebugId()),this.$6=t,e={onMQTTStateChanged:this.$18,onJSError:function(e){r.$4.logError("mqtt_js_error",e)}},t={appSpecificInfo:{},deviceId:this.$13()};var s=i("PolarisConfig").getLanguageCode();null!=s&&(t.appSpecificInfo["Accept-Language"]=s),n("PolarisMqttEnvInitializer").initialize(),s={endpoint:i("PolarisDirectConstants").PROD_MQTT_GATEWAY,userFbid:this.$11(),appId:this.$12(),initialSubscribedTopics:[],igSpecificOptions:t,observer:e,debugId:this.$4.getDebugId(),capabilities:0,clientCapabilities:1,chatVisibility:!0},this.$5=new(n("PolarisMqttChannel"))(s),this.$4.debugTrace("connect_end")},t.subscribeToLiveEvent=function(e,t,i){var r=this.$10;null!=r&&(t=new(n("PolarisLiveDeltaHandler"))(t),r.enableLiveEventHandler(e,t,i),r.subscribe())},t.unsubscribeToLiveEvent=function(e){var t=this.$10;null!=t&&(t.disableLiveEventHandler(e),t.subscribe())},t.getLogger=function(){return this.$4},e}(),o.DirectMQTT=e},98);